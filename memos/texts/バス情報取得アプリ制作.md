# バス情報取得アプリ制作記録

- 期間: 2025/04/19 - 2025/04/20
- 対応OS: Android
- IDE: Cursor
- AIモデル: Claude 3.7 Sonnet
- 開発言語: TypeScript
- フレームワーク: Ionic, Angular
- データベース: SQLite

# 概要
個人開発モチベーションが出てきたので、AI内蔵IDEであるCursorを使って2日でどこまでアプリを作れるか試してみることにしました。
構想自体は前々からあったので、それを要件定義として起こす部分からスタートしました。

# 作成するアプリの概要
- リアルタイムのバス情報を取得できるAndroidアプリ
- 取得したバス情報はローカルDBに保存され、アプリ内で参照できる

# 基本方針
- 資料作成、設計、コーディング、テスト全てをCursorにて作業を行う
- 資料作成と設計はマークダウンにて管理する
- Auto runモードを利用する
  - ※ユーザの許可無くコードの書き換えやターミナルコマンドの実行をごりごり行っていく恐ろしいモードです。その代わりとても速いです。
  (ワークスペース外のファイルは操作しないよう設定しています）

![001](../images/001.png)
>　自動実行モードでは、設定した許可リストと拒否リストに基づいてコマンドが実行されます。外部ソースからの潜在的なプロンプトインジェクションのリスクに注意し、自己責任でご利用ください。

時間が足りないので使えるものは使っていく方針です。Continueします。


# 2025/04/19

## 要件定義
Githubリポジトリ作成と連携を済ませ、要件定義書の作成を行います。
なお、資料は全てCursorで作成し、マークダウンで記述します。
（もちろんこの制作記録もCursor + マークダウンで作成しています！）

私が記述した部分です↓。
```
# バス時刻取得アプリ要件定義

# 背景

- 広島県のバスは渋滞状況によって到着時刻が大きく異なるので、いつ到着するかの目処が付けづらい
- リアルタイムでバス情報を確認できるサイトとして、「くるけん」が存在するが、下記理由からやや不便
    - ブラウザを起動する必要があり、忙しい時は手間に感じる
    - 1つ前までのバス停しか通過した時刻が保持されない
    - 表示される到着予定時刻と実際の到着時刻が大きく異なる時がある

# ニーズ

- 日ごとに到着時刻を記録し、それを元にバス停にいつたどり着ければ間に合うかの指標になるようなデータを表示できるものが欲しい
    - 例えば「以前このバス停に〇〇分に付いているからおそらく到着時刻は〇〇分だろう」「〇〇分についておけばほぼほぼ間に合うだろう」など判断したい
- 忙しい朝でも素早くリアルタイムのバス情報を取得したい
```

これをもとに要件定義書を作成して貰いました。

```
# 機能要件
- リアルタイムバス情報の取得と表示
  - 通過したバス停
  - 到着予定時間
  - 運行状況（遅延、運休など）
- ローカルデータベースによる情報の保存
  - 過去の運行履歴
  - よく利用するバス停の保存
  - お気に入りルートの保存
- 検索機能
  - バス停名での検索
  - 路線名での検索
- お気に入り機能
  - よく利用するバス停の登録
  - よく利用するルートの登録

# 非機能要件

## 1. パフォーマンス
- データ取得は操作から1.5秒以内
- リアルタイムバス情報表示はアプリ起動から2秒以内
- 集積したバス情報表示はアプリ起動から4秒以内

## 2. ユーザーインターフェース
- シンプルで直感的な操作
- ユーザーがよく使う機能を目立たせる

## 3. ユーザーエクスペリエンス
- 画面起動からバス情報表示までは0~1タップ
- 集積したバス情報表示はアプリ起動から0~2タップ
```

出力された機能要件は2日間では無理そうだったので半分ぐらい削りましたが、それ以外の内容はほぼ変えていません。
非機能要件に関しては私が拘りたかったので8割ぐらい書き換えています。

## 基本設計
**AIさんに基本設計書を書いてもらいます。面倒なのでファイル設置も依頼します。**
```
要件定義書をもとに、基本設計書を作成してください。ファイル設置場所は要件定義と同様の構造にしてください。
```

**データの取得URLも資料化してもらいます。**
```
@https://www.bus-kyo.or.jp/gtfs-open-data にアクセスし、「広島電鉄」と「「広島バス」のGTFS-JPの取得URLとGTFS-RTの取得URLをテーブルとして記載してください。
ファイルは他の資料と同様の構造にして配置してください。
```

![003](../images/003.png)
いい感じです。

```
基本設計書の各項目をそれぞれ別ファイルに分割してください。
```
**出力された基本設計書は1ファイルにまとまっていて見づらく感じたので分割を依頼します。**
![004](../images/004.png)

元のファイルを削除するかどうか聞いてくれました。いろいろありがとうございます。
![005](../images/005.png)

## 各ファイルに対しての修正依頼
ここからは基本設計書のそれぞれのファイルに対してAIと対話しつつ改修を行います。

### システム概要

**分析はユーザーの判断に任せるのでツールが提供する機能を絞るよう書き換えてもらいます。**
```
過去の運行データの蓄積は必要ですが分析機能をツールが提供する必要はありません。資料の書き換えをお願いいたします。
```
![006](../images/006.png)

**別ファイルとの整合性を取ってもらいます。**
```
その他の基本設計書を見て過去データの分析機能に関しての記述があれば書き換えてください
```
![007](../images/007.png)

**気になる部分を書き直してもらいます。**
```
ツールとして分析機能を提供しないだけで、ユーザーにとってバスの遅延情報を判断しやすくなるような情報は表示したいです。（実装難易度、工数にもよります）
例えば曜日であればそこまで実装難易度も高くないと思うので表示したいです。
それ以外にも実装が簡単かつユーザーの判断に役立つような情報があれば書き換えていただいて問題ございません。
```
![008](../images/008.png)

**「分析機能は必要ない」という情報が抜け落ちた気がします。補足欄を追加してそこにメモ書きを残してもらいます。**
```
基本設計の各ファイルに補足セクションを追加してください。補足セクションはあなたが行った変更について資料化していない部分を思い出す用途や、あなたが気になった部分を記録しておく場などのメモ書き欄として利用されます。
また、補足セクションに関しての説明文も同時に各ファイルに記載してください。
この説明文は私のプロンプト通りに記述する必要は無く、あなたにとって理解しやすい言葉で書いてください。

その後「分析機能を実装する必要はない」という意味の文章をシステム概要の補足欄に追加してください。
```
![009](../images/009.png)
めっちゃいいです～。

**でもなんか仕様追加されてるっぽいですね。今後のことを考えてAIガイドラインファイルを作成してもらいます**
```
docsディレクトリ配下に"AI_DOCUMENTATION_GUIDELINES.md"というファイルを作成してください。
"AI_DOCUMENTATION_GUIDELINES.md"は以下のルールがあります。

- このファイルはあなたが資料修正を行う前に必ず参照しなければならないファイルです。
- このファイルの変更を行う場合は、必ず私に提案を行うようにしてください
- このファイルはあなたにとって理解しやすいよう文章を記述してください。

上記内容を理解したら、私にAI_DOCUMENTATION_GUIDELINES.mdに記述するべき内容を提案してください。
```
![011](../images/011.png)
なんかいっぱい返ってきてすごい！

**ぱっと見いい感じですがガイドライン自体の修正に関する記述が無いので追加してもらいます。**
```
下記の修正をお願いいたします。
- 小規模なプロジェクトなのでバージョン管理は不要です。
- 「AI_DOCUMENTATION_GUIDELINES.mdを修正する場合は私に提案を行うようにする」というルールを追加してください。
```

**偉いので褒めます**
```
修正ありがとうございます。とても良いですね。
ファイルの追加をお願いいたします。
```
![012](../images/012.png)


**基本設計に戻ります。機能設計書とデータ設計書を見ると人間にとっても必要っぽい情報も補足欄に追加しているので修正してもらいます**
```
機能設計書とデータ設計書の補足セクションの情報には基本設計として書き示しておく必要がある情報が記述されていると思います。
そういった情報は新しくセクションを作成する、もしくは該当機能の下にインデントを行うなど判断し、適切に記述を行ってください。

上記内容に関してAI_DOCUMENTATION_GUIDELINES.mdに記述する必要があれば、その旨を記述してください。
```
![013](../images/013.png)
ちょっと冗長ですが多分いい感じっぽいです。
でも提案とかいいつつ普通にファイル書き換えてますね。まあIDEの機能で変更点は出てくれるのでいいとします。

![014](../images/014.png)
基本設計書の修正の方は気になった部分が修正されていました。

### システム構成
システム概要だけで3時間ぐらい格闘していて疲れてきましたが進めます。

**列挙されていないライブラリ等があれば挙げてもらいます。**  
```
要件定義やその他基本設計を読み、他に必要なライブラリなどがあれば追記してください。
```
![015](../images/015.png)
**思ったより想定と違いました。**
そもそも要件定義に地図表示がないのに基本設計で地図表示機能が記述されてたりと、想定外が想定外を呼ぶような形となっているので他の資料から修正したいと思います。

ちなみに自動修正が行われた部分はファイルを開くと強調表示されており、そこからRejectも行えます。
![016](../images/016.png)

### 補足セクションの追加
**そういえば補足セクションを全ファイルに追加するのを忘れていました。**
```
基本設計の01~08に対して、補足セクションを追加してください。
また、既存の補足セクションの説明文に関して、AI_DOCUMENTATION_GUIDELINES.mdに記載されている情報と重複する部分がある場合はそれを削除してください。
もし、AI_DOCUMENTATION_GUIDELINES.mdに記載できる情報で網羅的に補足セクションの説明ができるのであれば、補足セクションの説明文自体を削除していただいても構いません。
```
![017](../images/017.png)
破壊的な修正が行われています……。(画像部分以外にも色々破壊されてました)

おそらくAIガイドラインの
```
- 補足セクションに記載された情報のうち、基本設計として必要な情報は適切なセクションに移動すること
- 基本設計情報の移動判断基準：
  - システムの動作に直接影響する情報
  - 実装時に必須となる情報
  - 他の設計書と連携が必要な情報
```
が悪さしてそうです。
**とりあえず全部Rejectし、AIガイドラインの該当部分を削除し、新しいAgentタブを開いてからもう一度同様の指示を行います。**

長いので要約を貼り付けます。
![018](../images/018.png)

**破壊的な修正は無くなりましたが、補足セクションが必須のものだと思ってそうです。
AIガイドラインに必要無いのであれば空欄で良い旨を追加します。
あと基本設計資料の修正を行う場合は要件定義の資料も読み取ってもらうことにします**
```
(AIガイドラインに追加)
- 補足セクションに対しての記載が必要だと判断した場合のみ補足セクションに追加すること
- 資料修正をするファイルの親ディレクトリにAI_DOCUMENTATION_GUIDELINESから始めるファイルが存在する場合は、追加でそのファイルも読み取ること
```

```
docs/基本設計ディレクトリにAI_DOCUMENTATION_GUIDELINES_基本設計.mdというファイルを追加してください。
そのファイルには下記の情報を追加してください。
- 「基本設計の修正を行う場合は要件定義資料も読み取る」という意味の文章
- 「まだdocs/AI_DOCUMENTATION_GUIDELINES.mdを読み取っていない場合は読み取る」という意味の文章
それ以外の情報は追加しないでください。
```
![019](../images/019.png)

```
1. 基本設計の01~08を開いて、情報を読み込んでください。
2. 補足セクションがある場合はそれを全て削除してください。(### メモ 含む)
3. 基本設計の01~08に対し補足セクションを追加してください。
4. AI_DOCUMENTATION_GUIDELINES.mdに記載されている情報を読み取り、適切に資料への記述を行ってください。
```
![020](../images/020.png)
OKとします……！

### 機能設計
まだ8分の1なんですね……。

**機能設計資料の修正を行います。**
```
マップの表示やGPSは利用しません。また、ツール側から分析機能は提供しません。
あくまでユーザが分析に利用するための情報のみ表示します。
```
![021](../images/021.png)
(省略)
![022](../images/022.png)
今回は連動して資料修正してくれました。助かる～～～～。

---
連動して資料修正を行ってくれるのであればファイル単位で指示を分けることは不要なので気になった部分を都度指示していくスタイルにしてみます

**特徴と個人開発であることを追記**
```
当システムは個人開発の小規模なプロジェクトであること、特徴としてシンプルさとデータ表示までのレスポンスの良さがあることを追記してください。
```
![023](../images/023.png)
いい感じに私の要望を言語化してくれている……。

**バックアップ処理は作らない**
```
過去データのバックアップは不要です。
```
![024](../images/024.png)
シンプルな要望にはシンプルに答えてくれる。

**文言修正**
```
意味を変えずに文言のみを他の資料に合わせて書き換えてください。
```
![025](../images/025.png)
直接指示していないけれど変わって欲しいと思った部分がきちんと書き換えられた。

**間違っている部分の修正と優先度設定**
```
バス情報を取得する際APIは使用しません。
カラーユニバーサルデザインの採用及び天気情報の取得は実現できたほうが望ましいですが、初期段階では優先度が低めです
```
![026](../images/026.png)
いい感じに修正してくれてます。

**意地悪なことを言ってみます**
```
重要な情報とはどのような情報ですか？具体的に記述してください。
```
![027](../images/027.png)
大事な情報を3つ挙げてくれました。

## データ設計
ちょっと大変そうですがやっていきます。

**ER図を作成してもらいます**
```
mermaidでER図を作成してください。
```
![028](../images/028.png)
それっぽいのを出してくれましたが、そもそも色々足りてないので追加してもらいます。

**テーブル情報の修正**
```
mermaidのER図をもとに、各DBテーブルの形を記述してください。
また各DBテーブルはマークダウンのテーブル記法で記述してください。
```
![029](../images/029.png)
いい感じです。

**資料面で気になる部分を修正してもらう**
```
- データベーススキーマの情報とテーブル定義の情報は内容が重複しているので一つにまとめてください。
- 簡単にテーブルごとの説明を追加してください。
- テーブル定義に論理名の情報を追加してください。
- ER図には論理名で表示するようにしてください。
```
![031](../images/031.png)
![032](../images/032.png)
![030](../images/030.png)
論理名書いて！と言ったらリレーションも日本語で書いてくれた。

## GTFS-JPから取得できる情報の列挙
DB設計より前にまず取得データがどういうものなのか知らないことには始まらないことに気づきました。私もAIも……。

```
docs/基本設計に新しくファイルを作成し、そのファイルにGTFS-JPから取得できるバス情報をすべて列挙してください。
また、そのファイルにはGTFS-JPから取得できるバス情報のうち、本プロジェクトで利用する情報を列挙してください。
それらはテーブル記法で定義してください。
```
![033](../images/033.png)
たくさん取得されました。

もう少しカラムごとの詳細な情報が欲しいのと、基本設計が定まっていない中で「ツールで利用する情報の列挙」は難しいので削除してもらいます。
（せっかく抽出したのにごめんね）
```
「本プロジェクトで利用する情報」セクションを削除してください。
テーブルに詳細説明カラム、フィールドに入る値の例を表すカラムを追加してください。詳細説明欄にはフィールドに対する説明、利用方法を記載してください。
また、ファイルの命名は他の基本設計書と同様のフォーマットとしてください。
```
![034](../images/034.png)
かなり見やすいです。

命名だけ惜しい。
![035](../images/035.png)
```
ファイル名は[連番]_[資料名].mdとしてください。
このルールをAI_DOCUMENTATION_GUIDELINES.mdに追加してください。
```
![036](../images/036.png)
03になってる……。
ファイルの命名変更は制約的に難しいのか、既存のファイルを残したまま新しいファイルとして生成しているようです。
単純な命名変更は手で行うほうが早そう。
![037](../images/037.png)

## GTFS-RTの情報もまとめてもらう
```
docs/基本設計にGTFS-RTにて取得できるデータの情報を記した資料を生成してください。
これもGTFS-JPの資料と同様テーブルとして記述してください。
```
![038](../images/038.png)
どうやら混雑度や乗車率も取得できるっぽいです。
任意なので広島県のバスが対応しているかはわかりませんが「くるけん」には混雑度などは載っていないので取得できるのであれば表示したいですね。

ここまでで12時間ぐらいです。疲れたので今日はここで終わります。

# 2025/04/20
## 使用するAIモデルの追加
現時点での高速リクエスト数は82件でした。
![039](../images/039.png)

本日からはいろいろなモデルに資料修正をお願いしながら進めていきたいと思います。
**Gemini 2.5 ProとGemini 2.5 Flashを追加します。**
![040](../images/040.png)

Gemini 2.5 ProはAPIKeyを通すと一定リクエストまでは無料で利用することができる（2025/04/20現在）ので[Google AI Studio](https://aistudio.google.com/app/apikey)からAPIキーを取得します。
**その後CursorでAPIキーを設定します。**
![042](../images/042.png)

**現在の利用状況を確認します。**
![043](../images/043.png)
先ほどテストで一回リクエストを送っているので使用率が4%となっています。

**お試しリクエストを送信します。**
![044](../images/044.png)

**モデルが知りたいので直接的に聞きます。**
![045](../images/045.png)

**利用状況を確認します。**
![046](../images/046.png)
表示上のmodelがgemini-2.0-proとなっている部分が気になりますが、使われているっぽいです。

**Cursorの高速リクエスト回数が利用されていないことを確認します。**
![047](../images/047.png)

**もやもやするので新しいタブで質問を変えて聞いてみます。**
![048](../images/048.png)
一瞬混乱しましたが、マイナーバージョンが違うだけで同じモデルという理解をしました。

## 資料修正 / GTFS-RT
昨日の続きから進めます。

```
型が配列となっているフィールドは中身の型も記載してください。
```
![049](../images/049.png)
なんかカラム追加してる……。

**プロンプトを変えてお願いしてみます。**
```
当資料の情報はGTFS-RTで取得される情報と完全に紐づいているべきです。
あなたがGTFS-RTの情報を知っていればその情報をもとに、知らない情報はWebから取得し、配列の型を記述してください。
```
![050](../images/050.png)
それっぽい感じになりました。
地味に有効期間の型が期間から配列に変更されてたりもしますね。

**資料の情報の再確認をしてもらいます**
```
GTFS-RTとGTFS-JPで取得できるすべての情報をWebから取得してください。
その後、基本設計書と情報の比較を行い、相違点があれば列挙してください。
ファイルの修正は行わないでください。
```
![051](../images/051.png)
結構資料化されていない情報が多いです。

補足情報がわりと重要そうでした。
![052](../images/052.png)

```
ありがとうございます。
新しくカラムとして「実験的」を追加してください。
型の情報は一般的な表現でなく、取得情報に合わせるようにしてください。
Webから取得した情報との相違点をすべて設計書に反映させてください。
```
![053](../images/053.png)
大規模な変更となってますがぱっと見は良さげです。

**GTFS-JPの方も修正してもらいます。**
```
資料の構成変更や補足セクションの修正などありがとうございます。
先程と同じ内容で09_GTFS-JPデータ仕様書.mdに対しても同様の修正を行ってください。
```
![054](../images/054.png)

**Webの情報と整合性が取れているか再確認してもらいます。**
```
GTFS-JP、GTFS-RTの情報をWebから取得してください。
その後、基本設計書との比較を行い、相違点があれば列挙してください。
```
![055](../images/055.png)
Gemini 2.5 Proの制限に達してしまったのでここからはCursorの高速リクエスト枠で利用していきます。

![056](../images/056.png)
まだ相違点があるようですが、最新仕様でない部分で差異が多く出ているのが原因っぽく、通常利用する部分は概ね良さそうです。

```
ありがとうございます。資料に反映していただいて問題ないです。
```
![057](../images/057.png)
補足セクションに追加する程度の差異っぽいです。

**新しいタブで再度相違点の洗い出しを行ってもらいます。**
```
GTFS-JP、GTFS-RTの情報をWebから取得してください。
その後、基本設計書との比較を行い、相違点があれば資料修正を行ってください。
```
![058](../images/058.png)
かなり少なくなりましたね。
これでOKとします。

![059](../images/059.png)
補足セクションがいい感じになってました。
情報の圧縮度合いがすばらしいです。


