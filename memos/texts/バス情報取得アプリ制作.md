# バス情報取得アプリ制作記録

- 期間: 2025/04/19 - 2025/04/20
- 対応OS: Android
- IDE: Cursor
- AIモデル: Claude 3.7 Sonnet
- 開発言語: TypeScript
- フレームワーク: Ionic, Angular
- データベース: SQLite

# 概要
個人開発モチベーションが出てきたので、AI内蔵IDEであるCursorを使って2日でどこまでアプリを作れるか試してみることにしました。
構想自体は前々からあったので、それを要件定義として起こす部分からスタートしました。

# 作成するアプリの概要
- リアルタイムのバス情報を取得できるAndroidアプリ
- 取得したバス情報はローカルDBに保存され、アプリ内で参照できる

# 基本方針
- 資料作成、設計、コーディング、テスト全てをCursorにて作業を行う
- 資料作成と設計はマークダウンにて管理する
- Auto runモードを利用する
  - ※ユーザの許可無くコードの書き換えやターミナルコマンドの実行をごりごり行っていく恐ろしいモードです。その代わりとても速いです。
  (ワークスペース外のファイルは操作しないよう設定しています）

![001](../images/001.png)
>　自動実行モードでは、設定した許可リストと拒否リストに基づいてコマンドが実行されます。外部ソースからの潜在的なプロンプトインジェクションのリスクに注意し、自己責任でご利用ください。

時間が足りないので使えるものは使っていく方針です。Continueします。


# 2025/04/19 10:00 ~ 

## 要件定義
Githubリポジトリ作成と連携を済ませ、要件定義書の作成を行います。
なお、資料は全てCursorで作成し、マークダウンで記述します。
（もちろんこの制作記録もCursor + マークダウンで作成しています！）

私が記述した部分です↓。
```
# バス時刻取得アプリ要件定義

# 背景

- 広島県のバスは渋滞状況によって到着時刻が大きく異なるので、いつ到着するかの目処が付けづらい
- リアルタイムでバス情報を確認できるサイトとして、「くるけん」が存在するが、下記理由からやや不便
    - ブラウザを起動する必要があり、忙しい時は手間に感じる
    - 1つ前までのバス停しか通過した時刻が保持されない
    - 表示される到着予定時刻と実際の到着時刻が大きく異なる時がある

# ニーズ

- 日ごとに到着時刻を記録し、それを元にバス停にいつたどり着ければ間に合うかの指標になるようなデータを表示できるものが欲しい
    - 例えば「以前このバス停に〇〇分に付いているからおそらく到着時刻は〇〇分だろう」「〇〇分についておけばほぼほぼ間に合うだろう」など判断したい
- 忙しい朝でも素早くリアルタイムのバス情報を取得したい
```

これをもとに要件定義書を作成して貰いました。

```
# 機能要件
- リアルタイムバス情報の取得と表示
  - 通過したバス停
  - 到着予定時間
  - 運行状況（遅延、運休など）
- ローカルデータベースによる情報の保存
  - 過去の運行履歴
  - よく利用するバス停の保存
  - お気に入りルートの保存
- 検索機能
  - バス停名での検索
  - 路線名での検索
- お気に入り機能
  - よく利用するバス停の登録
  - よく利用するルートの登録

# 非機能要件

## 1. パフォーマンス
- データ取得は操作から1.5秒以内
- リアルタイムバス情報表示はアプリ起動から2秒以内
- 集積したバス情報表示はアプリ起動から4秒以内

## 2. ユーザーインターフェース
- シンプルで直感的な操作
- ユーザーがよく使う機能を目立たせる

## 3. ユーザーエクスペリエンス
- 画面起動からバス情報表示までは0~1タップ
- 集積したバス情報表示はアプリ起動から0~2タップ
```

出力された機能要件は2日間では無理そうだったので半分ぐらい削りましたが、それ以外の内容はほぼ変えていません。
非機能要件に関しては私が拘りたかったので8割ぐらい書き換えています。

# 2025/04/19 12:00 ~ 

## 基本設計
**AIさんに基本設計書を書いてもらいます。面倒なのでファイル設置も依頼します。**
```
要件定義書をもとに、基本設計書を作成してください。ファイル設置場所は要件定義と同様の構造にしてください。
```

**データの取得URLも資料化してもらいます。**
```
@https://www.bus-kyo.or.jp/gtfs-open-data にアクセスし、「広島電鉄」と「「広島バス」のGTFS-JPの取得URLとGTFS-RTの取得URLをテーブルとして記載してください。
ファイルは他の資料と同様の構造にして配置してください。
```

![003](../images/003.png)
いい感じです。

```
基本設計書の各項目をそれぞれ別ファイルに分割してください。
```
**出力された基本設計書は1ファイルにまとまっていて見づらく感じたので分割を依頼します。**
![004](../images/004.png)

元のファイルを削除するかどうか聞いてくれました。いろいろありがとうございます。
![005](../images/005.png)

## 各ファイルに対しての修正依頼
ここからは基本設計書のそれぞれのファイルに対してAIと対話しつつ改修を行います。

### システム概要

**分析はユーザーの判断に任せるのでツールが提供する機能を絞るよう書き換えてもらいます。**
```
過去の運行データの蓄積は必要ですが分析機能をツールが提供する必要はありません。資料の書き換えをお願いいたします。
```
![006](../images/006.png)

**別ファイルとの整合性を取ってもらいます。**
```
その他の基本設計書を見て過去データの分析機能に関しての記述があれば書き換えてください
```
![007](../images/007.png)

**気になる部分を書き直してもらいます。**
```
ツールとして分析機能を提供しないだけで、ユーザーにとってバスの遅延情報を判断しやすくなるような情報は表示したいです。（実装難易度、工数にもよります）
例えば曜日であればそこまで実装難易度も高くないと思うので表示したいです。
それ以外にも実装が簡単かつユーザーの判断に役立つような情報があれば書き換えていただいて問題ございません。
```
![008](../images/008.png)

**「分析機能は必要ない」という情報が抜け落ちた気がします。補足欄を追加してそこにメモ書きを残してもらいます。**
```
基本設計の各ファイルに補足セクションを追加してください。補足セクションはあなたが行った変更について資料化していない部分を思い出す用途や、あなたが気になった部分を記録しておく場などのメモ書き欄として利用されます。
また、補足セクションに関しての説明文も同時に各ファイルに記載してください。
この説明文は私のプロンプト通りに記述する必要は無く、あなたにとって理解しやすい言葉で書いてください。

その後「分析機能を実装する必要はない」という意味の文章をシステム概要の補足欄に追加してください。
```
![009](../images/009.png)
めっちゃいいです～。

**でもなんか仕様追加されてるっぽいですね。今後のことを考えてAIガイドラインファイルを作成してもらいます**
```
docsディレクトリ配下に"AI_DOCUMENTATION_GUIDELINES.md"というファイルを作成してください。
"AI_DOCUMENTATION_GUIDELINES.md"は以下のルールがあります。

- このファイルはあなたが資料修正を行う前に必ず参照しなければならないファイルです。
- このファイルの変更を行う場合は、必ず私に提案を行うようにしてください
- このファイルはあなたにとって理解しやすいよう文章を記述してください。

上記内容を理解したら、私にAI_DOCUMENTATION_GUIDELINES.mdに記述するべき内容を提案してください。
```
![011](../images/010.png)
なんかいっぱい返ってきてすごい！

**ぱっと見いい感じですがガイドライン自体の修正に関する記述が無いので追加してもらいます。**
```
下記の修正をお願いいたします。
- 小規模なプロジェクトなのでバージョン管理は不要です。
- 「AI_DOCUMENTATION_GUIDELINES.mdを修正する場合は私に提案を行うようにする」というルールを追加してください。
```

**偉いので褒めます**
```
修正ありがとうございます。とても良いですね。
ファイルの追加をお願いいたします。
```
![012](../images/011.png)


**基本設計に戻ります。機能設計書とデータ設計書を見ると人間にとっても必要っぽい情報も補足欄に追加しているので修正してもらいます**
```
機能設計書とデータ設計書の補足セクションの情報には基本設計として書き示しておく必要がある情報が記述されていると思います。
そういった情報は新しくセクションを作成する、もしくは該当機能の下にインデントを行うなど判断し、適切に記述を行ってください。

上記内容に関してAI_DOCUMENTATION_GUIDELINES.mdに記述する必要があれば、その旨を記述してください。
```
![013](../images/012.png)
ちょっと冗長ですが多分いい感じっぽいです。
でも提案とかいいつつ普通にファイル書き換えてますね。まあIDEの機能で変更点は出てくれるのでいいとします。

![014](../images/013.png)
基本設計書の修正の方は気になった部分が修正されていました。

### システム構成
システム概要だけで3時間ぐらい格闘していて疲れてきましたが進めます。

